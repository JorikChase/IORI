<!doctype html>
<html lang="en">
    <head>
        <title>3die</title>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
        />
        <link rel="icon" type="image/x-icon" href="/IORI/3die.ico" />
        <link type="text/css" rel="stylesheet" href="/IORI/assets/main.css" />
        <link type="text/css" rel="stylesheet" href="/IORI/assets/burger.css" />
        <style>
            .websites {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr;
                grid-template-rows: 1fr 1fr;
                position: absolute;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
            }
            .websites > div {
                width: 100%;
                height: 100%;
                background: rgba(173, 216, 230, 0.622);
                display: flex;
                justify-content: center;
                align-items: flex-end;
                padding: 1em;
                background-size: cover;
                background-repeat: no-repeat;
                background-position: center;
                opacity: 0;
                transition: all 0.5s ease-in-out;
                border-radius: 3px;
            }
            .websites > div:hover {
                width: 100%;
                height: 100%;
                padding: 2em;
                opacity: 1;
            }
            .zsprodeti:hover {
                background-image: url(/IORI/assets/zsprodeti-bg.png);
            }
            .flashtones:hover {
                background-image: url(/IORI/assets/flashtones-bg.png);
            }
            .livesupp:hover {
                background-image: url(/IORI/assets/livesupp-bg.png);
            }
            .terycomputer:hover {
                background-image: url(/IORI/assets/terycomputer-bg.png);
            }
            .jarojaro:hover {
                background-image: url(/IORI/assets/jarojaro-bg.png);
            }
            .kucharkybezdomova:hover {
                background-image: url(/IORI/assets/kucharkybezdomova-bg.png);
            }
            .website-link {
                height: 2em;
                width: 100%;
                background-size: contain;
                background-repeat: no-repeat;
            }
            @media (orientation: portrait) {
                .websites {
                    grid-template-columns: 1fr;
                    grid-template-rows: 1fr 1fr 1fr 1fr 1fr 1fr;
                }
                .websites > div {
                    opacity: 1;
                }
                .websites > .zsprodeti {
                    background-image: url(/IORI/assets/zsprodeti-bg.png);
                }
                .websites > .flashtones {
                    background-image: url(/IORI/assets/flashtones-bg.png);
                }
                .websites > .livesupp {
                    background-image: url(/IORI/assets/livesupp-bg.png);
                }
                .websites > .terycomputer {
                    background-image: url(/IORI/assets/terycomputer-bg.png);
                }
                .websites > .jarojaro {
                    background-image: url(/IORI/assets/jarojaro-bg.png);
                }
                .websites > .kucharkybezdomova {
                    background-image: url(/IORI/assets/kucharkybezdomova-bg.png);
                }
            }
            .container {
                position: relative;
                width: 100vw;
                height: 100vh;
            }

            .bubble {
                position: absolute;
                border-radius: 50%;
                overflow: hidden;
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
                cursor: pointer;
                border: 2px solid rgba(255, 255, 255, 0.1);
                background: #111;
                transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .bubble:hover:not(.fullscreen) {
                transform: scale(1.5);
                z-index: 100;
                box-shadow: 0 0 30px rgba(255, 255, 255, 0.2);
            }

            .bubble.fullscreen {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw !important;
                height: 100vh !important;
                border-radius: 0;
                z-index: 1000;
                border: none;
            }

            .bubble iframe {
                width: 100%;
                height: 100%;
                border: none;
                opacity: 0.9;
                transition: opacity 0.3s;
            }

            .bubble:hover iframe {
                opacity: 1;
            }

            .title {
                position: fixed;
                top: 2rem;
                left: 2rem;
                color: white;
                font-size: 1.5rem;
                opacity: 0.8;
                z-index: 1000;
            }

            .bubble-title {
                position: absolute;
                bottom: -25px;
                left: 50%;
                transform: translateX(-50%);
                color: white;
                font-size: 12px;
                white-space: nowrap;
                opacity: 0;
                transition: opacity 0.3s;
            }

            .bubble:hover .bubble-title {
                opacity: 1;
            }

            .close-button {
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(255, 255, 255, 0.2);
                border: none;
                color: white;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                cursor: pointer;
                z-index: 1001;
                display: none;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                transition: background 0.3s;
            }

            .close-button:hover {
                background: rgba(255, 255, 255, 0.3);
            }

            .close-button.visible {
                display: flex;
            }
        </style>
    </head>
    <body>
        <script
            async
            src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"
        ></script>

        <script type="importmap">
            {
                "imports": {
                    "three": "https://threejs.org/build/three.module.js",
                    "three/addons/": "https://threejs.org/examples/jsm/"
                }
            }
        </script>

        <script type="module">
            import * as THREE from "three";

            import { RGBELoader } from "three/addons/loaders/RGBELoader.js";

            import { GUI } from "three/addons/libs/lil-gui.module.min.js";

            import { EffectComposer } from "three/addons/postprocessing/EffectComposer.js";
            import { RenderPass } from "three/addons/postprocessing/RenderPass.js";
            import { ShaderPass } from "three/addons/postprocessing/ShaderPass.js";
            import { FilmPass } from "three/addons/postprocessing/FilmPass.js";
            import { RGBShiftShader } from "three/addons/shaders/RGBShiftShader.js";

            import { FontLoader } from "three/addons/loaders/FontLoader.js";
            import { TextGeometry } from "three/addons/geometries/TextGeometry.js";

            // declarations

            let camera, scene, renderer, composer;
            let cube,
                foregroundObj,
                midgroundObj,
                backgroundObj,
                documentObj,
                foregroundMaterial,
                midgroundMaterial,
                backgroundMaterial,
                documentMaterial,
                textObj,
                textGeometry,
                textMaterial;

            let cubeCamera, cubeRenderTarget;

            let mouseX = 0,
                mouseY = 0;

            let windowHalfX = window.innerWidth / 2;
            let windowHalfY = window.innerHeight / 2;

            init();

            //init

            function init() {
                //scope

                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setAnimationLoop(animation);
                renderer.outputEncoding = THREE.sRGBEncoding;
                renderer.toneMapping = THREE.ACESFilmicToneMapping;
                renderer.toneMappingExposure = 1.3;
                document.body.appendChild(renderer.domElement);

                document.addEventListener("mousemove", onDocumentMouseMove);

                window.addEventListener("resize", onWindowResized);

                // camera

                camera = new THREE.PerspectiveCamera(
                    90,
                    window.innerWidth / window.innerHeight,
                    1,
                    1000,
                );
                camera.position.z = 70;

                scene = new THREE.Scene();

                // hdri

                new RGBELoader()
                    .setPath("/IORI/assets/")
                    .load("websitesBackground.hdr", function (texture) {
                        texture.mapping =
                            THREE.EquirectangularReflectionMapping;

                        scene.background = texture;
                        scene.environment = texture;
                    });

                // objects

                const documentTexture = new THREE.TextureLoader().load(
                    "/IORI/assets/websites/one-page.png",
                );

                documentMaterial = new THREE.MeshStandardMaterial({
                    map: documentTexture,
                    emissiveMap: documentTexture,
                    emissive: 0.5,
                });
                const foregroundTexture = new THREE.TextureLoader().load(
                    "/IORI/assets/websites/frontMap.jpg",
                );
                const foregroundAplha = new THREE.TextureLoader().load(
                    "/IORI/assets/websites/frontAlpha.jpg",
                );

                foregroundMaterial = new THREE.MeshStandardMaterial({
                    transparent: true,
                    alphaMap: foregroundAplha,
                    map: foregroundTexture,
                    emissiveMap: foregroundTexture,
                    emissive: 0.5,
                });
                const midgroundTexture = new THREE.TextureLoader().load(
                    "/IORI/assets/websites/midMap.jpg",
                );
                const midgroundAlpha = new THREE.TextureLoader().load(
                    "/IORI/assets/websites/midAlpha.jpg",
                );

                midgroundMaterial = new THREE.MeshStandardMaterial({
                    transparent: true,
                    alphaMap: midgroundAlpha,
                    map: midgroundTexture,
                    emissiveMap: midgroundTexture,
                    emissive: 0.5,
                });
                const backgroundTexture = new THREE.TextureLoader().load(
                    "/IORI/assets/websites/backMap.jpg",
                );
                const backgroundAlpha = new THREE.TextureLoader().load(
                    "/IORI/assets/websites/backAlpha.jpg",
                );

                backgroundMaterial = new THREE.MeshStandardMaterial({
                    transparent: true,
                    alphaMap: backgroundAlpha,
                    map: backgroundTexture,
                    emissiveMap: backgroundTexture,
                    emissive: 0.5,
                });

                documentObj = new THREE.Mesh(
                    new THREE.PlaneGeometry(210 * 0.25, 297 * 0.25),
                    documentMaterial,
                );
                scene.add(documentObj);
                documentObj.position.z = -25;
                documentObj.position.x = 55;
                documentObj.position.y = 15;

                foregroundObj = new THREE.Mesh(
                    new THREE.PlaneGeometry(150, 150),
                    foregroundMaterial,
                );
                scene.add(foregroundObj);
                foregroundObj.position.z = 10;

                midgroundObj = new THREE.Mesh(
                    new THREE.PlaneGeometry(250, 250),
                    midgroundMaterial,
                );
                scene.add(midgroundObj);
                midgroundObj.position.y = 20;
                midgroundObj.position.z = -50;

                backgroundObj = new THREE.Mesh(
                    new THREE.PlaneGeometry(400, 400),
                    backgroundMaterial,
                );
                scene.add(backgroundObj);
                backgroundObj.position.y = 50;
                backgroundObj.position.z = -200;

                composer = new EffectComposer(renderer);
                composer.addPass(new RenderPass(scene, camera));

                //
            }

            function onWindowResized() {
                windowHalfX = window.innerWidth / 2;
                windowHalfY = window.innerHeight / 2;

                renderer.setSize(window.innerWidth, window.innerHeight);
                composer.setSize(window.innerWidth, window.innerHeight);

                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
            }

            function onDocumentMouseMove(event) {
                mouseX = (event.clientX - windowHalfX) / 2;
                mouseY = (event.clientY - windowHalfY) / 2;
            }

            function animation(msTime) {
                // fps update

                camera.position.x += (-mouseX / 50 - camera.position.x) * 0.01;
                camera.position.y += (mouseY / 50 - camera.position.y) * 0.02;

                camera.lookAt(scene.position);

                renderer.render(scene, camera);

                composer.render();
            }
        </script>
        <nav class="menu--bottom--right" role="navigation">
            <div class="menuToggle">
                <input type="checkbox" />
                <span></span>
                <span></span>
                <span></span>
                <ul class="menuItem">
                    <li><a href="./index.html">home</a></li>
                    <li><a href="./portfolio.html">portfolio</a></li>
                    <li><a href="./shop.html">shop</a></li>
                    <li><a href="./info.html">info</a></li>
                </ul>
            </div>
        </nav>
        <div class="container" id="bubbleContainer"></div>
        <button class="close-button" id="closeButton">×</button>

        <script>
            class BubblePortfolio {
                constructor() {
                    this.container = document.getElementById("bubbleContainer");
                    this.closeButton = document.getElementById("closeButton");
                    this.bubbles = [];
                    this.websites = [
                        { url: "https://zsprodeti.cz/", title: "ZS Pro Deti" },
                        { url: "https://flashtones.cz/", title: "Flashtones" },
                        { url: "https://livesupp.com/", title: "LiveSupp" },
                        {
                            url: "https://andrea-sokova.glitch.me/",
                            title: "Andrea Sokova",
                        },
                        {
                            url: "https://flame-simulation.glitch.me/",
                            title: "Flame sim",
                        },
                        {
                            url: "https://heartbreaking-happy-pluto.glitch.me/",
                            title: "kalivoda",
                        },
                        {
                            url: "https://tin-imported-dungeon.glitch.me/",
                            title: "Tery Computer",
                        },
                        {
                            url: "https://jarojaro.glitch.me/",
                            title: "Jaroslav Jaro",
                        },
                        {
                            url: "https://kucharkybezdomova.glitch.me/",
                            title: "Kucharky Bez Domova",
                        },
                    ];
                    this.init();
                    this.animate();
                    this.setupEventListeners();
                }

                init() {
                    this.websites.forEach((site, i) => {
                        const size = Math.random() * (180 - 140) + 140;
                        const bubble = document.createElement("a");
                        bubble.className = "bubble";
                        bubble.style.width = size + "px";
                        bubble.style.height = size + "px";
                        bubble.href = "javascript:void(0)"; // Prevent default anchor behavior

                        const iframe = document.createElement("iframe");
                        iframe.src = site.url;
                        bubble.appendChild(iframe);

                        const title = document.createElement("div");
                        title.className = "bubble-title";
                        title.textContent = site.title;
                        bubble.appendChild(title);

                        this.container.appendChild(bubble);

                        this.bubbles.push({
                            element: bubble,
                            iframe: iframe,
                            x: Math.random() * (window.innerWidth - size),
                            y: Math.random() * (window.innerHeight - size),
                            speedX: (Math.random() - 0.5) * 2,
                            speedY: (Math.random() - 0.5) * 2,
                            size: size,
                            mass: size,
                            originalSize: size,
                            originalX: 0,
                            originalY: 0,
                        });
                    });
                }

                setupEventListeners() {
                    this.bubbles.forEach((bubble) => {
                        bubble.element.addEventListener("click", (e) => {
                            e.preventDefault();
                            if (
                                !bubble.element.classList.contains("fullscreen")
                            ) {
                                this.expandBubble(bubble);
                            }
                        });
                    });

                    this.closeButton.addEventListener("click", () => {
                        this.bubbles.forEach((bubble) => {
                            if (
                                bubble.element.classList.contains("fullscreen")
                            ) {
                                this.collapseBubble(bubble);
                            }
                        });
                    });
                }

                expandBubble(bubble) {
                    // Store original position
                    const rect = bubble.element.getBoundingClientRect();
                    bubble.originalX = rect.left;
                    bubble.originalY = rect.top;
                    bubble.element.style.transform = "none";

                    // Pause animation for this bubble
                    bubble.isExpanded = true;

                    // Add fullscreen class
                    bubble.element.classList.add("fullscreen");
                    this.closeButton.classList.add("visible");
                }

                collapseBubble(bubble) {
                    bubble.element.classList.remove("fullscreen");
                    this.closeButton.classList.remove("visible");

                    // Resume animation
                    bubble.isExpanded = false;
                }

                checkCollision(b1, b2) {
                    const dx = b2.x - b1.x;
                    const dy = b2.y - b1.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    return distance < (b1.size + b2.size) / 2;
                }

                resolveCollision(b1, b2) {
                    const dx = b2.x - b1.x;
                    const dy = b2.y - b1.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    const nx = dx / distance;
                    const ny = dy / distance;

                    const rvx = b2.speedX - b1.speedX;
                    const rvy = b2.speedY - b1.speedY;

                    const velAlongNormal = rvx * nx + rvy * ny;

                    if (velAlongNormal > 0) return;

                    const restitution = 0.8;
                    const impulseMagnitude =
                        -(1 + restitution) * velAlongNormal;
                    const impulse =
                        impulseMagnitude / (1 / b1.mass + 1 / b2.mass);

                    b1.speedX -= (impulse * nx) / b1.mass;
                    b1.speedY -= (impulse * ny) / b1.mass;
                    b2.speedX += (impulse * nx) / b2.mass;
                    b2.speedY += (impulse * ny) / b2.mass;
                }

                animate() {
                    this.bubbles.forEach((bubble) => {
                        if (!bubble.isExpanded) {
                            bubble.x += bubble.speedX;
                            bubble.y += bubble.speedY;

                            if (
                                bubble.x <= 0 ||
                                bubble.x >= window.innerWidth - bubble.size
                            ) {
                                bubble.speedX *= -0.8;
                                bubble.x =
                                    bubble.x <= 0
                                        ? 0
                                        : window.innerWidth - bubble.size;
                            }
                            if (
                                bubble.y <= 0 ||
                                bubble.y >= window.innerHeight - bubble.size
                            ) {
                                bubble.speedY *= -0.8;
                                bubble.y =
                                    bubble.y <= 0
                                        ? 0
                                        : window.innerHeight - bubble.size;
                            }

                            bubble.speedX *= 0.995;
                            bubble.speedY *= 0.995;
                        }
                    });

                    for (let i = 0; i < this.bubbles.length; i++) {
                        for (let j = i + 1; j < this.bubbles.length; j++) {
                            if (
                                !this.bubbles[i].isExpanded &&
                                !this.bubbles[j].isExpanded &&
                                this.checkCollision(
                                    this.bubbles[i],
                                    this.bubbles[j],
                                )
                            ) {
                                this.resolveCollision(
                                    this.bubbles[i],
                                    this.bubbles[j],
                                );
                            }
                        }
                    }

                    this.bubbles.forEach((bubble) => {
                        if (!bubble.isExpanded) {
                            bubble.element.style.left = bubble.x + "px";
                            bubble.element.style.top = bubble.y + "px";
                        }
                    });

                    requestAnimationFrame(() => this.animate());
                }
            }

            document.addEventListener("DOMContentLoaded", () => {
                new BubblePortfolio();
            });
        </script>
    </body>
</html>
