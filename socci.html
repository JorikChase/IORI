<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
      <style>
        .socci-wrap {
        }

        @keyframes rotate {
          0% {
            transform: rotate(-30deg);
          }
          50% {
            transform: rotate(0deg);
          }
          100% {
            transform: rotate(30deg);
          }
        }

        body, html {
          margin: 0;
          padding: 0;
          height: 100%;
          width: 100%;
          scroll-behavior: smooth;
        }

        .socci-map-wrap {
          width: 100%;
          height: 100svh;
          background-color: #bee3e6;
          overflow: hidden;
          transition: all 0.5s ease-in-out;
        }

        .socci-map-wrap:hover {
          height: 100svh;
        }
        .socci-map-wrap:hover .map-link {
        opacity: 1;
        }

        #map-container {
          position: relative;
          width: 100%;
          height: 90%;
          cursor: grab;
          transition: none;

        }

        #map-container.grabbing {
          cursor: grabbing;
        }
        #map-container img{
          height: 150%;
        }
        #map-container > div {
          position: absolute;
          inset: 0;
          width: 100%;
          height: 100%;
          display: flex;
          justify-content: center;
          align-items: center;
          transition: none;
          pointer-events: none;
          user-select: none;
        }

        .map-link {
          position: absolute;
          width: auto;
          height: auto;
          line-height: 6px;
          color: black !important;
          padding: 1px 2px;
          border-radius: 1px;
          text-align: center;
          font-size: 25px;
          font-weight: bold;
          color: white;
          user-select: none;
          cursor: pointer;
          text-decoration: none;
          transform-origin: center;
          transition: none;
          transition: background-color 0.5s ease-in-out;
          /* opacity: 0; */
          transition: opacity 0.5s ease-in-out;
        }

        .map-link:hover {
          background-color: rgba(255, 255, 255, 0.7);
        }
        .map-link.postavy{
            width: 60px;
            height: 60px;
            background: url(/images/sites/iori/images/postavy.png);
            background-size: cover;
        }
      </style>

      <div class="socci-wrap">
        <div class="socci-map-wrap" id="SocciMap">
          <div id="map-container">
            <div id="layer4" data-speed="0.5">
              <img alt="Background Layer" src="/images/sites/iori/images/socci-base-island.avif" />
            </div>
            <a href="https://ostrovsocci.cz/" class="map-link" style="bottom: 30%; left: 40%;">
              Ostrov Socci
            </a>
            <a href="/doma/postavy" class="map-link postavy" style="top: 50%; left: 45%;"></a>
            <a href="/doma/bota" class="map-link" style="top: 12%; right: 30%;"> Komix </a>
            <div id="layer3" data-speed="1">
              <img alt="cloud Layer" src="/images/sites/iori/images/socci-mraky-base.png" />
            </div>
            <div id="layer2" data-speed="1.5">
              <img alt="cloud Layer" src="/images/sites/iori/images/socci-mraky-2.png" />
            </div>
            <div id="layer1" data-speed="2">
              <img alt="cloud Layer" src="/images/sites/iori/images/socci-mraky-3.png" />
            </div>
            <!-- Link elements -->
          </div>
        </div>
      </div>

      <script>
        const mapContainer = document.getElementById('map-container');
        const layers = document.querySelectorAll('#map-container > div');
        const links = document.querySelectorAll('.map-link');
        const layer4Img = document.querySelector('#layer4 img');

        let isDragging = false;
        let startX, startY;
        let translateX = 0, translateY = 0;
        let currentX = 0, currentY = 0;
        let scale = 1;
        const zoomSpeed = 0.01;
        const maxZoom = 3;
        const minZoom = 1;
        let maxTranslateX = 0, maxTranslateY = 0, minTranslateX = 0, minTranslateY = 0;

        function getContentSize() {
          return {
            width: layer4Img.offsetWidth,
            height: layer4Img.offsetHeight
          };
        }

        function checkBounds() {
          const containerWidth = mapContainer.offsetWidth;
          const containerHeight = mapContainer.offsetHeight;
          const content = getContentSize();
          const scaledWidth = content.width * scale;
          const scaledHeight = content.height * scale;

          maxTranslateX = Math.max((scaledWidth - containerWidth) / 4, 0);
          minTranslateX = -maxTranslateX;
          maxTranslateY = Math.max((scaledHeight - containerHeight) / 4, 0);
          minTranslateY = -maxTranslateY;

          translateX = Math.min(Math.max(translateX, minTranslateX), maxTranslateX);
          translateY = Math.min(Math.max(translateY, minTranslateY), maxTranslateY);
        }

        function handleStart(x, y) {
          isDragging = true;
          mapContainer.classList.add('grabbing');
          startX = x;
          startY = y;
          currentX = translateX;
          currentY = translateY;
        }

        function handleMove(x, y) {
          if (!isDragging) return;
          const deltaX = x - startX;
          const deltaY = y - startY;

          translateX = currentX + deltaX;
          translateY = currentY + deltaY;

          checkBounds();
          updateTransform();
          applyParallax();
        }

        // Initialize after image loads
        function init() {
          checkBounds();
          applyParallax();
          updateLinks();
        }

        if (layer4Img.complete) {
          init();
        } else {
          layer4Img.addEventListener('load', init);
        }

        window.addEventListener('resize', init);

        // Mouse events
        mapContainer.addEventListener('mousedown', (e) => {
          if (e.target.classList.contains('map-link')) return;
          handleStart(e.clientX, e.clientY);
        });

        document.addEventListener('mousemove', (e) => handleMove(e.clientX, e.clientY));
        document.addEventListener('mouseup', () => {
          isDragging = false;
          mapContainer.classList.remove('grabbing');
        });

        // Touch events
        mapContainer.addEventListener('touchstart', (e) => {
          if (e.target.classList.contains('map-link')) return;
          handleStart(e.touches[0].clientX, e.touches[0].clientY);
        });

        document.addEventListener('touchmove', (e) => {
          e.preventDefault();
          handleMove(e.touches[0].clientX, e.touches[0].clientY);
        }, { passive: false });

        document.addEventListener('touchend', () => {
          isDragging = false;
          mapContainer.classList.remove('grabbing');
        });

        mapContainer.addEventListener('wheel', (e) => {
          e.preventDefault();
          const delta = e.deltaY > 0 ? -zoomSpeed : zoomSpeed;
          const prevScale = scale;
          scale = Math.min(maxZoom, Math.max(minZoom, scale + delta));

          if (scale !== prevScale) {
            checkBounds();
            updateTransform();
            applyParallax();
          }
        });

        function updateTransform() {
          mapContainer.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
          updateLinks();
        }

        function applyParallax() {
          layers.forEach((layer) => {
            const speed = parseFloat(layer.getAttribute('data-speed'));
            const offsetX = -translateX * (1 - 1 / speed);
            const offsetY = -translateY * (1 - 1 / speed);
            layer.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
          });
        }

        function updateLinks() {
          links.forEach((link) => {
            link.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
          });
        }
      </script>
  </body>
</html>
